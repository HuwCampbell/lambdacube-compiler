
pipeline (projmat :: Mat 4 4 Float)
         (vertexstream :: VertexStream Triangle (Vec 4 Float))

    = FrameBuffer (DepthImage @1 1000, ColorImage @1 navy)
  `overlay`
      vertexstream
    & transformVertices (scale 0.5 . (projmat *.))
    & rasterize (TriangleCtx CullNone PolygonFill NoOffset LastVertex)
    & filterFragmentStream PassAll
    & fragmentShaderRastDepth (\x -> x)
    & accumulateWith (DepthOp Less True, ColorOp NoBlending (V4 True True True True))

main = ScreenOut $
    pipeline (Uniform @(Mat 4 4 Float) "MVP")
             (Fetch @Triangle "stream4" (Attribute @(Vec 4 Float) "position4"))

